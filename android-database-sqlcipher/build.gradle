apply plugin: "com.android.library"
apply plugin: "org.ec4j.editorconfig"
apply from: "native.gradle"
apply from: "maven.gradle"

android {

  compileSdkVersion 26

  defaultConfig {
    versionName "${clientVersionNumber}"
    minSdkVersion "${minimumAndroidSdkVersion}"
    targetSdkVersion "${targetAndroidSdkVersion}"
    versionCode 1
    versionName "${clientVersionNumber}"
  }

  editorconfig {
   includes = ["src/**", "build.gradle"]
   excludes = ["src/main/external/sqlcipher/**", "src/main/external/openssl-*/**"]
  }

  buildTypes {
    debug {
      debuggable true
    }
    release {
      debuggable false
      minifyEnabled false
    }
  }

  sourceSets {
    main {
      jniLibs.srcDirs "${rootProject.ext.nativeRootOutputDir}/libs"
    }
  }

  check.dependsOn editorconfigCheck
  clean.dependsOn cleanNative
  preBuild.dependsOn([buildOpenSSL, buildAmalgamation])

  afterEvaluate {
    android.libraryVariants.all { variant ->
      variant.javaCompile.dependsOn(buildNative)
      variant.outputs.each { output ->
        def outputFile = output.outputFile
        if (outputFile != null && outputFile.name.endsWith(".aar")) {
          def buildSuffix = variant.buildType.debuggable ? "-debug" : ""
          def versionFileName = "${archivesBaseName}-${clientVersionNumber}${buildSuffix}.aar"
          output.outputFileName = versionFileName
        }
      }
    }
  }

}
